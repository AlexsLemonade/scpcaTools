---
params:
  sample: Example
  sce: !r SingleCellExperiment::SingleCellExperiment()
  date: !r Sys.Date()

title: "`r glue::glue('ScPCA QC report for {params$sample}')`"
author: "CCDL"
date: "`r params$date`"
output: 
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
---

# Introduction
```{r setup, message=FALSE}
library(SingleCellExperiment)
```

# Processing Information for `r params$sample`

```{r echo=FALSE}
# extract sce metadata containing processing information as table
metadata_list <- metadata(params$sce) 

processing_info <- tibble::tibble(
  "Salmon Version" = metadata_list$salmon_version,
  "Alevin-fry Version" = metadata_list$alevinfry_version,
  "Transcriptome index" = metadata_list$reference_index,
  "Filtering Method" = metadata_list$af_permit_type,
  "Resolution" = metadata_list$af_resolution, 
  "Unspliced transcripts included" = dplyr::case_when(
      metadata_list$transcript_type == "spliced" ~ "No",
      metadata_list$transcript_type == "unspliced" ~ "Yes" )
  ) %>%
  t() %>%
  # remove any empty slots before making table
  na.omit()

if(!is.null(processing_info)){
  # remove underscores from rownames for table 
  rownames(processing_info) = str_replace_all(rownames(processing_info), "\\.", " ")

  # make table with processing information
  knitr::kable(processing_info, "simple")
} else {
  glue::glue("No processing information available for {params$sample}")
}
```


```{r echo=FALSE}
sample_information <- data.frame(
  "Sample ID" = params$sample,
  "10X version" = metadata_list$version_10X,
  "Number of reads sequenced" = format(metadata_list$total_reads, big.mark = ',', scientific = FALSE)
  "Number of Mapped Reads" = metadata_list$mapped_reads,
  "Number of Cells Reported by Alevin-fry" = metadata_list$num_cells
) %>%
  t() %>%
  # remove any empty slots before making table
  na.omit()

if(!is.null(sample_information)){
  # remove underscores from rownames for table 
  rownames(sample_information) = str_replace_all(rownames(sample_information), "\\.", " ")

  # make table with processing information
  knitr::kable(sample_information, "simple")
} else {
  glue::glue("No sample information available for {params$sample}")
}
```

# `r params$sample` Experiment Summary 

This sample has `r ncol(params$sce)` cells, assayed for `r nrow(params$sce)` genes.

# Session Info
```{r session_info}
sessioninfo::session_info()
```


